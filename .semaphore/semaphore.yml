version: v1.0
name: Zammad CI
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
auto_cancel:
  running:
    when: 'true'
global_job_config:
  prologue:
    commands:
      - checkout
  env_vars:
    - name: RAILS_ENV
      value: test
    - name: Z_LOCALES
      value: 'en-us:de-de'
    - name: CI_SKIP_ASSETS_PRECOMPILE
      value: 'true'
    - name: CI_SKIP_DB_RESET
      value: 'true'
blocks:
  - name: CI
    task:
      jobs:
        - name: CI
          commands:
            - echo "test"
promotions:
  - name: staging
    pipeline_file: pipeline_2.yml
    deployment_target: staging
    auto_promote:
      when: branch = 'single-tests' AND result = 'passed'
  - name: production
    pipeline_file: pipeline_3.yml
    deployment_target: production
  - name: development
    pipeline_file: pipeline_4.yml
    deployment_target: development
    auto_promote:
      when: branch = 'single-tests' AND result = 'passed'
